{% extends 'base.html' %}

{% block content %}

{#
    {% for r in rses %}
        <p><a href="./show_rse?rse={{r}}">{{r}}</a></p>
    {% endfor %}
#}

<p><span style="color:gray">sort by:</span>
    <a href="?sort=rse">RSE</a> |
    CC run <a href="?sort=-cc_run">(+)</a> <a href="?sort=cc_run">(-)</a> |
    unmerged run  <a href="?sort=-um_run">(+)</a> <a href="?sort=um_run">(-)</a>
</p>

<table class="data" id="data">

<tr>
    <th rowspan=3>RSE</th>
    <th colspan=9>Data Consistency</th>
    <th colspan=4>Unmerged Files</th>
</tr>
<tr>
    <th rowspan=2>Last run</th>
    <th rowspan=2>Status</th>
    <th colspan=4>Dark files</th>
    <th colspan=3>Missing files</th>
    <th rowspan=2>Last run</th>
    <th rowspan=2>Elapsed time</th>
    <th rowspan=2>Status</th>
    <th rowspan=2>Files</th>
</tr>
<tr>
    <th>Detected</th>
    <th>Confirmed</th>
    <th>Acted</th>
    <th>Action status</th>

    <th>Detected</th>
    <th>Acted</th>
    <th>Action status</th>
</tr>

{% for info in infos %}
    {% set rse = info["rse"] %}
    {% set cc_summary = info["cc_summary"] %}
    {% set um_summary = info["um_summary"] %}

    <tr>
        <td><a href="./show_rse?rse={{rse}}">{{rse}}</a></td>
        {% if cc_summary is none %}
            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
        {% else %}
            <td><a href="./show_run?rse={{rse}}&run={{cc_summary['run']}}">{{cc_summary['start_time']|as_dt}}</a></td>
            <td class="{{cc_summary['status']}}">{{cc_summary["status"]|none_as_blank}}</td>
            <td>{{cc_summary["dark_stats"]["detected"]|none_as_blank}}</td>
            <td>{{cc_summary["dark_stats"]["confirmed"]|none_as_blank}}</td>
            <td>{{cc_summary["dark_stats"]["acted_on"]|none_as_blank}}</td>
            <td class="{{cc_summary['dark_stats']['action_status']|none_as_blank}}">
                {{cc_summary['dark_stats']['action_status']|none_as_blank}}
            </td>
            
            <td>{{cc_summary["missing_stats"]["detected"]|none_as_blank}}</td>
            <td>{{cc_summary["missing_stats"]["acted_on"]|none_as_blank}}</td>
            <td class="{{cc_summary['missing_stats']['action_status']|none_as_blank}}">
                {{cc_summary['missing_stats']['action_status']|none_as_blank}}
            </td>
        {% endif %}
        
        {% if um_summary is none %}
            <td></td><td></td><td></td><td></td>
        {% else %}
            <td><a href="./unmerged/show_run?rse={{rse}}&run={{um_summary['run']}}">{{um_summary['start_time']|as_dt}}</a></td>
            <td>{{um_summary['elapsed_time']|hms}}</td>
            <td class="{{um_summary['status']}}">{{um_summary["status"]}}</td>
            <td>{{um_summary["files"]|none_as_blank}}</td>
        {% endif %}
    </tr>
{% endfor %}
            
</table>


{% endblock %}
