{% extends 'base.html' %}

{% block html_head %}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
{% endblock %}

{% block headline %}RSE {{rse}}{% endblock %}


{% block link_menu %}<a href="./index">home</a>{% endblock %}



{% block content %}

<table class="placement">
	<tr>
		<td>
			<table class="data">
    
    
			    <tr>
			        <th rowspan=2>Run</th><th rowspan=2>Start time</th><th rowspan=2>Status</th><th colspan=3>Missing</th><th colspan=4>Dark</th>
			    </tr>
			    <tr>
			        <th>Detected</th><th>Acted</th><th>Action status</th>
			        <th>Detected</th><th>Confirmed</th><th>Acted</th><th>Action status</th>
			    </tr>
			    {% for t, info in runs %}
			        <tr>
			            <td><a href="./show_run?rse={{rse}}&run={{t}}" class="run">{{t}}</a></td>
			            <td>{{info["start_time"]|as_dt}}</td>
			            <td class="{{info['status'] or ''}}">
                            {%- if info["status"] == "started" and "running" in info -%}
                                {{info["running"] or ""}} started
                            {%- else -%}
                                {{info["status"] or ""}}
                            {%- endif -%}
                        </td>
			            <td>{{info["nmissing"]|none_as_blank}}</td>
                        <td>{{info["acted_missing"]|none_as_blank}}</td>
                        <td class="{{info['missing_status']|none_as_blank}}">{{info["missing_status"]|none_as_blank}}</td>
			            <td>{{info["ndark"]|none_as_blank}}</td>
			            <td>{{info["confirmed_dark"]|none_as_blank}}</td>
                        <td>{{info["acted_dark"]|none_as_blank}}</td>
                        <td class="{{info['dark_status']|none_as_blank}}">{{info["dark_status"]|none_as_blank}}</td>
			        </tr>
			    {% endfor %}
    
			</table>
		</td>
		<td style="padding:1px 50px">
			<div id="chart"></div>
			<script type="text/javascript">
		        google.charts.load('current', {'packages':['bar']});
		        google.charts.setOnLoadCallback(drawChart);
				// runs is in reversed order
				var data = [
					['Run', 'Detected dark', 'Detected missing']
					{% for t, info in runs|reverse %}
                    ,[	    "{{info['start_time']|as_date}}", 
							{{info["ndark"] if info["ndark"] is not none else "null"}},
							{{info["nmissing"] if info["nmissing"] is not none else "null"}}
						]
					{% endfor %}
				];
				
				var options = {
						  colors: ["#888", "FA8"],
						  bar: {
							  groupWidth: "90%"
						  },
                          //hAxis: {
                          //    format:"MMM d, y"
                          //},
				          chart: {
				            //title: 'Run history'
				          }
				        };
						
				function drawChart()
				{
					var dataTable = google.visualization.arrayToDataTable(data);
					var chart = new google.charts.Bar(document.getElementById('chart'));
					chart.draw(dataTable, google.charts.Bar.convertOptions(options));
				}
			</script>
		</td>
	</tr>
</table>

{% endblock %}
